<nb-layout>

  <nb-layout-header fixed>
    <div class="d-flex justify-content-between w-100">
      <nb-actions>
        <nb-action icon="funnel-outline" (click)="toggleFilter()"></nb-action>
      </nb-actions>
      <h3>
        簡訊小尖兵
      </h3>
      <nb-actions>
        <nb-action class="control-item" icon="email-outline" (click)="openWindow(contentTemplate)"></nb-action>
        <nb-action class="control-item" icon="moon-outline" (click)="toggleDarkMode()"></nb-action>
      </nb-actions>
    </div>

  </nb-layout-header>

  <nb-sidebar left tag="filter" state="collapsed">
    <nb-search type="rotate-layout"></nb-search>
    <input nbInput placeholder="傳送日期" [nbDatepicker]="rangepicker" shape="round" class="my-5">
    <nb-rangepicker #rangepicker [max]="today"></nb-rangepicker>
    <div class="my-auto">

      <span class="subheader">電信</span>
      <hr>
      <nb-checkbox status="primary">CHT</nb-checkbox>
      <nb-checkbox status="danger">FET</nb-checkbox>
      <br>
      <span class="subheader">發送用途</span>
      <hr>
      <nb-checkbox status="primary">指令</nb-checkbox>
      <nb-checkbox status="success">通知</nb-checkbox>
      <nb-checkbox status="warning">其他</nb-checkbox>
      <br>
      <span class="subheader">狀態</span>
      <hr>
      <nb-checkbox status="info">處理中</nb-checkbox>
      <nb-checkbox status="primary">傳送中</nb-checkbox>
      <nb-checkbox status="success">已成功</nb-checkbox>
      <nb-checkbox status="danger">已失敗</nb-checkbox>
      <nb-checkbox status="warning">電信拒絕</nb-checkbox>
    </div>

  </nb-sidebar>


  <nb-layout-column>
    <nb-card class="row mx-0">
      <nb-accordion multi nbInfiniteList [threshold]="500" pageSize="5" class="col-12 col-lg-8">
        <nb-accordion-item *ngFor="let msg of historyMessage" class="row mx-0 ">
          <nb-accordion-item-header>
            <div class="col-2 col-sm-1 ">
                <app-status-chart [msgDestination]="msg.destination"></app-status-chart>
            </div>
            <p class="col-7 my-auto text-break">
              {{ msg.content }}
            </p>
            <p class="col-2 my-auto">
              {{ msg.dateTime | amLocal | amDateFormat: 'MM/DD, HH:mm:ss'}}
              <br>
              <span class="text-muted">{{ msg.dateTime | amTimeAgo }}</span>
            </p>
            <nb-badge *ngIf="msg.destination.length > 1" [text]="msg.destination.length" status="danger"></nb-badge>

          </nb-accordion-item-header>
          <nb-accordion-item-body>
            <div class="row">
              <nb-user [name]="msg.user" onlyPicture="false" class="col-2"></nb-user>
            </div>
            <nb-list>
              <nb-list-item *ngFor="let destination of msg.destination" class="row mx-0 p">
                <app-status class="col-1 my-auto" [status]="destination.status"></app-status>
                <div class="col-3 my-auto text-break text-center"> {{ destination.number }}</div>
                <div class="col-3 my-auto text-break">
                  {{ destination.successDateTime || destination.updateDateTime | amLocal | amDateFormat: 'MM/DD, HH:mm:ss'}}
                  <br>
                  {{ destination.successDateTime || destination.updateDateTime | amDifference: msg.dateTime :'second' | amDuration: 'seconds' }}
                </div>
                <div class="col-3 my-auto text-break">
                  <span class="text-muted" *ngIf=" destination.messageId "> 訊息編號</span> {{ destination.messageId }}
                  <br>
                  <span class="text-muted">電信回應</span> {{ destination.responseText }}</div>
              </nb-list-item>
            </nb-list>
            <!-- {{ msg.option.telecom }} -->
          </nb-accordion-item-body>
        </nb-accordion-item>
      </nb-accordion>
    </nb-card>

    <router-outlet></router-outlet>

  </nb-layout-column>

</nb-layout>

<ng-template #contentTemplate let-data>
  <p>Here is the text provided via config: "{{ data.text }}"</p>
</ng-template>